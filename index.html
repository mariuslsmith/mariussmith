<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marius Smith - Pixel World</title>
    <meta name="description" content="Interactive pixel art portfolio for Marius Smith. Navigate the pixel world to explore my work.">
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            background: #0a0a0a;
            color: #fff;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #canvas {
            border: 4px solid #444;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            cursor: crosshair;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.8);
            transition: filter 0.3s ease;
            display: block;
        }

        #canvas.blurred {
            filter: blur(8px);
        }
        
        #status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            font-size: 12px;
            color: #999;
            background: rgba(0, 0, 0, 0.9);
            padding: 12px 20px;
            border-radius: 4px;
            z-index: 10;
            line-height: 1.6;
            border: 1px solid #333;
        }
        
        #status strong {
            color: #fff;
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                transform: translateY(30px);
                opacity: 0;
            }
            to { 
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content {
            background: #0a0a0a;
            border: 2px solid #333;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            padding: 50px;
            position: relative;
            animation: slideUp 0.4s ease;
            font-family: 'Courier New', monospace;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 24px;
            transition: color 0.2s ease;
            font-family: 'Courier New', monospace;
        }

        .modal-close:hover {
            color: #fff;
        }

        .modal-content h1 {
            margin: 0 0 30px 0;
            font-size: 24px;
            font-weight: normal;
            color: #fff;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .modal-content h2 {
            margin: 40px 0 20px 0;
            font-size: 16px;
            font-weight: normal;
            color: #ccc;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .modal-content p {
            line-height: 1.8;
            color: #aaa;
            margin: 15px 0;
            font-size: 14px;
        }

        .soundcloud-embed {
            margin: 30px 0;
            padding: 0;
            background: #000;
        }

        .soundcloud-embed h3 {
            margin: 0 0 20px 0;
            font-size: 14px;
            font-weight: normal;
            color: #999;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .soundcloud-embed iframe {
            border: 1px solid #222;
        }

        .work-in-progress {
            padding: 40px;
            text-align: center;
            color: #666;
            font-size: 14px;
            letter-spacing: 2px;
            border: 1px dashed #333;
            margin: 20px 0;
        }

        .game-container {
            width: 100%;
            max-width: 900px;
        }

        .game-info {
            text-align: center;
            margin-bottom: 20px;
            color: #999;
            font-size: 14px;
        }

        .game-info .score {
            font-size: 24px;
            color: #fff;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            #status {
                font-size: 10px;
                bottom: 10px;
                left: 10px;
                right: 10px;
                padding: 10px 15px;
            }

            .modal-content {
                padding: 40px 25px;
            }

            .modal-content h1 {
                font-size: 20px;
            }
        }

        /* Custom scrollbar for modal */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: #0a0a0a;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: #333;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #444;
        }
    </style>
</head>
<body>
    <div id="canvas-container">
        <canvas id="canvas"></canvas>
    </div>
    
    <div id="status">
        <strong>Marius Smith</strong> | mariussmith.xyz | Navigate to houses to explore my work | Arrow keys or WASD to move | Enter to enter house | ESC to exit
    </div>

    <!-- Modal Overlays -->
    <div id="modal-about" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-close" onclick="closeModal('about')">×</div>
            <h1>About</h1>
            <p>Optimistic techno-optimist. +10 years as operator at tech-finance frontiers. Investor. Occasional lectures. Currently Head of EigenCloud at Eigen Labs.</p>
        </div>
    </div>

    <div id="modal-works" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-close" onclick="closeModal('works')">×</div>
            <h1>Works</h1>
            <div class="work-in-progress">
                WORK IN PROGRESS
            </div>
        </div>
    </div>

    <div id="modal-music" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-close" onclick="closeModal('music')">×</div>
            <h1>Music</h1>
            
            <div class="soundcloud-embed">
                <h3>Weekly Pick #1</h3>
                <iframe width="100%" height="300" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/1550310835&color=%23666666&auto_play=false&hide_related=false&show_comments=false&show_user=true&show_reposts=false&show_teaser=true&visual=true"></iframe>
            </div>
        </div>
    </div>

    <!-- Game Modal -->
    <div id="modal-game" class="modal-overlay">
        <div class="modal-content game-container">
            <div class="modal-close" onclick="closeModal('game')">×</div>
            <h1>Robot Runner</h1>
            <div class="game-info">
                <div>SPACE or CLICK to jump</div>
                <div class="score">Score: <span id="game-score">0</span></div>
                <div id="game-status"></div>
            </div>
            <canvas id="game-canvas" width="800" height="400" style="border: 2px solid #333; background: #050510; display: block; margin: 0 auto;"></canvas>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d', { alpha: false });
        ctx.imageSmoothingEnabled = false;
        
        let TILESIZE = 32;
        let GRID_WIDTH = 32;
        let GRID_HEIGHT = 24;

        // Dynamic canvas sizing
        function resizeCanvas() {
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            
            const targetRatio = 4 / 3;
            let width, height;
            
            if (windowWidth / windowHeight > targetRatio) {
                height = windowHeight - 100;
                width = height * targetRatio;
            } else {
                width = windowWidth - 40;
                height = width / targetRatio;
            }
            
            canvas.width = width;
            canvas.height = height;
            
            TILESIZE = Math.floor(width / GRID_WIDTH);
            
            drawWorld();
        }

        let map = Array(GRID_HEIGHT).fill().map(() => Array(GRID_WIDTH).fill(0));

        // Houses - 2x2 tiles
        map[10][6] = map[10][7] = map[11][6] = map[11][7] = 1; // About
        map[10][14] = map[10][15] = map[11][14] = map[11][15] = 2; // Works
        map[10][22] = map[10][23] = map[11][22] = map[11][23] = 3; // Music

        // Game sign
        map[19][27] = 4; // "Let's Play" sign

        let avatar = { x: 15, y: 14 };
        let animationFrame = 0;
        const houses = {
            1: 'about',
            2: 'works',
            3: 'music',
            4: 'game'
        };

        // Social icons - moved to row 21 to be more visible
        const socialIcons = [
            { x: 28, y: 21, type: 'twitter', url: 'https://x.com/mariuslsmith' },
            { x: 30, y: 21, type: 'linkedin', url: 'https://www.linkedin.com/in/mariuslundingsmith/' }
        ];

        // Pixel font
        const pixelFont = {
            'M': [1,1,0,1,1,1,1,1,1,1,1,0,1,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1],
            'A': [0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1],
            'R': [1,1,1,1,0,1,0,0,0,1,1,1,1,1,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1,1,0,0,0,1],
            'I': [1,1,1,1,1,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,1,1,1,1,0,0,0,0,0],
            'U': [1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0],
            'S': [0,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0],
            'H': [1,0,0,0,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1],
            'T': [1,1,1,1,1,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0],
            'L': [1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0],
            'E': [1,1,1,1,1,1,0,0,0,0,1,1,1,1,0,1,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0],
            'P': [1,1,1,1,0,1,0,0,0,1,1,1,1,1,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0],
            'Y': [1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0],
            ' ': [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
        };

        function drawPixelText(text, startX, startY, scale = 4) {
            ctx.fillStyle = '#fff';
            let x = startX;
            for (let char of text.toUpperCase()) {
                if (pixelFont[char]) {
                    for (let i = 0; i < 35; i++) {
                        const col = i % 5;
                        const row = Math.floor(i / 5);
                        if (pixelFont[char][i]) {
                            ctx.fillRect(x + col * scale, startY + row * scale, scale, scale);
                        }
                    }
                    x += 6 * scale;
                }
            }
        }

        function drawTwitterIcon(x, y) {
            ctx.fillStyle = '#fff';
            const s = 3;
            for (let i = 0; i < 6; i++) {
                ctx.fillRect(x + i * s, y + i * s, s, s);
            }
            for (let i = 0; i < 6; i++) {
                ctx.fillRect(x + (5 - i) * s, y + i * s, s, s);
            }
        }

        function drawLinkedInIcon(x, y) {
            ctx.fillStyle = '#fff';
            const s = 2;
            for (let i = 0; i < 12; i++) {
                ctx.fillRect(x + i * s, y, s, s);
                ctx.fillRect(x + i * s, y + 11 * s, s, s);
                ctx.fillRect(x, y + i * s, s, s);
                ctx.fillRect(x + 11 * s, y + i * s, s, s);
            }
            ctx.fillRect(x + 3 * s, y + 3 * s, s, s);
            for (let i = 5; i < 9; i++) {
                ctx.fillRect(x + 3 * s, y + i * s, s, s);
            }
            for (let i = 5; i < 9; i++) {
                ctx.fillRect(x + 6 * s, y + i * s, s, s);
            }
            ctx.fillRect(x + 7 * s, y + 5 * s, s, s);
            for (let i = 6; i < 9; i++) {
                ctx.fillRect(x + 8 * s, y + i * s, s, s);
            }
        }

        function drawSocialIcons() {
            socialIcons.forEach(icon => {
                const x = icon.x * TILESIZE;
                const y = icon.y * TILESIZE;
                
                if (icon.type === 'twitter') {
                    drawTwitterIcon(x + 6, y + 6);
                } else if (icon.type === 'linkedin') {
                    drawLinkedInIcon(x + 4, y + 4);
                }
            });
        }

        function drawRobot(x, y, frame) {
            const px = x * TILESIZE;
            const py = y * TILESIZE;
            
            ctx.fillStyle = '#c0c0c0';
            ctx.fillRect(px + 10, py + 4, 12, 8);
            
            ctx.fillStyle = frame % 20 < 18 ? '#00ff00' : '#004400';
            ctx.fillRect(px + 12, py + 6, 3, 3);
            ctx.fillRect(px + 17, py + 6, 3, 3);
            
            ctx.fillStyle = '#c0c0c0';
            ctx.fillRect(px + 15, py + 2, 2, 2);
            
            ctx.fillStyle = '#a0a0a0';
            ctx.fillRect(px + 9, py + 12, 14, 10);
            
            ctx.fillStyle = '#333';
            ctx.fillRect(px + 13, py + 14, 6, 6);
            
            ctx.fillStyle = '#c0c0c0';
            const armOffset = Math.floor(frame / 5) % 2;
            ctx.fillRect(px + 6, py + 14 + armOffset, 3, 6);
            ctx.fillRect(px + 23, py + 14 + (1 - armOffset), 3, 6);
            
            const legOffset = Math.floor(frame / 5) % 2;
            ctx.fillRect(px + 11, py + 22, 4, 6 - legOffset);
            ctx.fillRect(px + 17, py + 22, 4, 6 - (1 - legOffset));
        }

        function drawGameSign(x, y) {
            const px = x * TILESIZE;
            const py = y * TILESIZE;
            
            // Sign post
            ctx.fillStyle = '#8b4513';
            ctx.fillRect(px + 13, py + 12, 6, 16);
            
            // Sign board
            ctx.fillStyle = '#f5f5dc';
            ctx.fillRect(px + 2, py + 2, 28, 16);
            
            // Border
            ctx.fillStyle = '#8b4513';
            ctx.fillRect(px + 2, py + 2, 28, 2);
            ctx.fillRect(px + 2, py + 16, 28, 2);
            ctx.fillRect(px + 2, py + 2, 2, 16);
            ctx.fillRect(px + 28, py + 2, 2, 16);
            
            // Text "PLAY"
            ctx.fillStyle = '#ff0066';
            ctx.font = `bold ${Math.floor(TILESIZE * 0.45)}px Courier New`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('PLAY', px + 16, py + 10);
        }

        function drawHouse(gridX, gridY, type) {
            const px = gridX * TILESIZE;
            const py = gridY * TILESIZE;
            const size = TILESIZE * 2;
            
            if (type === 1) { // About - white house
                // Main building
                ctx.fillStyle = '#f0f0f0';
                ctx.fillRect(px, py + size * 0.25, size, size * 0.75);
                
                // Roof - proper triangle
                ctx.fillStyle = '#8b4513';
                ctx.beginPath();
                ctx.moveTo(px - 6, py + size * 0.25);
                ctx.lineTo(px + size / 2, py - 6);
                ctx.lineTo(px + size + 6, py + size * 0.25);
                ctx.lineTo(px, py + size * 0.25);
                ctx.closePath();
                ctx.fill();
                
                // Door
                ctx.fillStyle = '#8b4513';
                ctx.fillRect(px + size * 0.35, py + size * 0.6, size * 0.3, size * 0.4);
                
                // Windows
                ctx.fillStyle = '#87ceeb';
                ctx.fillRect(px + size * 0.1, py + size * 0.4, size * 0.2, size * 0.2);
                ctx.fillRect(px + size * 0.7, py + size * 0.4, size * 0.2, size * 0.2);
                
            } else if (type === 2) { // Works - gray house
                // Main building
                ctx.fillStyle = '#a0a0a0';
                ctx.fillRect(px, py + size * 0.25, size, size * 0.75);
                
                // Roof
                ctx.fillStyle = '#555';
                ctx.beginPath();
                ctx.moveTo(px - 6, py + size * 0.25);
                ctx.lineTo(px + size / 2, py - 6);
                ctx.lineTo(px + size + 6, py + size * 0.25);
                ctx.lineTo(px, py + size * 0.25);
                ctx.closePath();
                ctx.fill();
                
                // Door
                ctx.fillStyle = '#654321';
                ctx.fillRect(px + size * 0.35, py + size * 0.6, size * 0.3, size * 0.4);
                
                // Windows
                ctx.fillStyle = '#4169e1';
                ctx.fillRect(px + size * 0.1, py + size * 0.35, size * 0.25, size * 0.25);
                ctx.fillRect(px + size * 0.65, py + size * 0.35, size * 0.25, size * 0.25);
                
            } else if (type === 3) { // Music - Berghain (no roof, brutalist)
                ctx.fillStyle = '#2a2a2a';
                ctx.fillRect(px, py, size, size);
                
                const neonColors = ['#ff0066', '#00ffff', '#00ff00', '#ff00ff'];
                const stripWidth = 4;
                const spacing = Math.floor(size / 5);
                
                for (let i = 0; i < 4; i++) {
                    ctx.fillStyle = neonColors[i];
                    ctx.fillRect(px + spacing + i * spacing, py + 8, stripWidth, size - 16);
                }
                
                ctx.fillStyle = '#3a3a3a';
                ctx.fillRect(px, py, size, 3);
                ctx.fillRect(px, py + size - 3, size, 3);
            }
        }

        function drawWorld() {
            // Sky
            ctx.fillStyle = '#050510';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Stars
            ctx.fillStyle = '#fff';
            for (let i = 0; i < 100; i++) {
                const x = (i * 97) % canvas.width;
                const y = (i * 73) % (12 * TILESIZE);
                const size = (i % 3) + 1;
                ctx.fillRect(x, y, size, size);
            }

            // Moon
            const moonX = canvas.width - 100;
            const moonY = 80;
            const moonR = 35;
            
            const glowGradient = ctx.createRadialGradient(moonX, moonY, 0, moonX, moonY, moonR * 2);
            glowGradient.addColorStop(0, 'rgba(255, 255, 136, 0.8)');
            glowGradient.addColorStop(0.4, 'rgba(255, 200, 100, 0.4)');
            glowGradient.addColorStop(1, 'rgba(255, 255, 0, 0)');
            ctx.fillStyle = glowGradient;
            ctx.beginPath();
            ctx.arc(moonX, moonY, moonR * 2, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#fffacd';
            ctx.beginPath();
            ctx.arc(moonX, moonY, moonR, 0, Math.PI * 2);
            ctx.fill();

            // Ground
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 12 * TILESIZE, canvas.width, canvas.height);

            // Road
            ctx.fillStyle = '#252838';
            ctx.fillRect(0, 18 * TILESIZE, canvas.width, 4 * TILESIZE);
            
            ctx.fillStyle = '#3a3f52';
            for (let i = 0; i < GRID_WIDTH; i += 3) {
                ctx.fillRect(i * TILESIZE, 19.5 * TILESIZE, TILESIZE, 4);
            }

            // Grass
            ctx.fillStyle = '#16213e';
            for (let i = 0; i < 300; i++) {
                const x = (i * 113) % canvas.width;
                const y = 12 * TILESIZE + ((i * 79) % (6 * TILESIZE));
                ctx.fillRect(x, y, 2, 2);
            }

            // Trees
            for (let i = 1; i < GRID_WIDTH - 1; i += 6) {
                if (![6, 7, 14, 15, 22, 23, 27].includes(i)) {
                    ctx.fillStyle = '#1a3a1a';
                    ctx.fillRect(i * TILESIZE + 4, 13 * TILESIZE, 24, 16);
                    ctx.fillRect(i * TILESIZE + 8, 13 * TILESIZE - 4, 16, 8);
                    
                    ctx.fillStyle = '#3d2817';
                    ctx.fillRect(i * TILESIZE + 12, 13 * TILESIZE + 12, 8, 8);
                }
            }

            // Flowers
            for (let i = 0; i < 50; i++) {
                const x = (i * 157) % canvas.width;
                const y = 12 * TILESIZE + ((i * 97) % (6 * TILESIZE));
                ctx.fillStyle = i % 3 === 0 ? '#ff6b9d' : '#ffd700';
                ctx.fillRect(x, y, 3, 3);
            }

            // Title
            drawPixelText('MARIUS SMITH', TILESIZE * 2, TILESIZE * 2.5, 4);

            // Draw houses
            drawHouse(6, 10, 1); // About
            drawHouse(14, 10, 2); // Works
            drawHouse(22, 10, 3); // Music

            // Draw game sign
            drawGameSign(27, 19);

            drawSocialIcons();

            // Labels - moved up to 9 * TILESIZE
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 12px Courier New';
            ctx.textAlign = 'center';
            ctx.fillText('ABOUT', 7 * TILESIZE, 9 * TILESIZE);
            ctx.fillText('WORKS', 15 * TILESIZE, 9 * TILESIZE);
            ctx.fillText('MUSIC', 23 * TILESIZE, 9 * TILESIZE);

            drawRobot(avatar.x, avatar.y, animationFrame);
        }

        // ===== GEOMETRY DASH GAME =====
        let gameRunning = false;
        let gameScore = 0;
        let gameCanvas, gameCtx;
        
        class GameRobot {
            constructor() {
                this.x = 100;
                this.y = 300;
                this.width = 30;
                this.height = 30;
                this.velocityY = 0;
                this.gravity = 0.8;
                this.jumpPower = -15;
                this.onGround = false;
                this.frame = 0;
            }

            jump() {
                if (this.onGround) {
                    this.velocityY = this.jumpPower;
                    this.onGround = false;
                }
            }

            update() {
                this.velocityY += this.gravity;
                this.y += this.velocityY;
                
                if (this.y >= 300) {
                    this.y = 300;
                    this.velocityY = 0;
                    this.onGround = true;
                }
                this.frame++;
            }

            draw(ctx) {
                ctx.fillStyle = '#c0c0c0';
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                ctx.fillStyle = '#00ff00';
                ctx.fillRect(this.x + 5, this.y + 8, 6, 6);
                ctx.fillRect(this.x + 19, this.y + 8, 6, 6);
                
                ctx.fillStyle = '#c0c0c0';
                ctx.fillRect(this.x + 13, this.y - 4, 4, 4);
            }
        }

        class Obstacle {
            constructor(x) {
                this.x = x;
                this.y = 290;
                this.width = 20;
                this.height = 40;
                this.speed = 5;
            }

            update() {
                this.x -= this.speed;
            }

            draw(ctx) {
                ctx.fillStyle = '#ff0066';
                ctx.beginPath();
                ctx.moveTo(this.x, this.y + this.height);
                ctx.lineTo(this.x + this.width / 2, this.y);
                ctx.lineTo(this.x + this.width, this.y + this.height);
                ctx.closePath();
                ctx.fill();
            }

            collidesWith(robot) {
                return robot.x < this.x + this.width &&
                       robot.x + robot.width > this.x &&
                       robot.y < this.y + this.height &&
                       robot.y + robot.height > this.y;
            }
        }

        let gameRobot;
        let obstacles = [];
        let gameAnimationId;

        function initGame() {
            gameCanvas = document.getElementById('game-canvas');
            gameCtx = gameCanvas.getContext('2d');
            gameCtx.imageSmoothingEnabled = false;
            
            gameRobot = new GameRobot();
            obstacles = [];
            gameScore = 0;
            gameRunning = true;
            
            document.getElementById('game-score').textContent = '0';
            document.getElementById('game-status').textContent = '';
            
            gameLoop();
        }

        function gameLoop() {
            if (!gameRunning) return;
            
            gameCtx.fillStyle = '#050510';
            gameCtx.fillRect(0, 0, 800, 400);
            
            gameCtx.fillStyle = '#1a1a2e';
            gameCtx.fillRect(0, 330, 800, 70);
            
            gameRobot.update();
            gameRobot.draw(gameCtx);
            
            if (Math.random() < 0.02) {
                obstacles.push(new Obstacle(800));
            }
            
            for (let i = obstacles.length - 1; i >= 0; i--) {
                obstacles[i].update();
                obstacles[i].draw(gameCtx);
                
                if (obstacles[i].collidesWith(gameRobot)) {
                    gameRunning = false;
                    document.getElementById('game-status').textContent = 'GAME OVER! Click to restart';
                    document.getElementById('game-status').style.color = '#ff0066';
                }
                
                if (obstacles[i].x + obstacles[i].width < 0) {
                    obstacles.splice(i, 1);
                    gameScore++;
                    document.getElementById('game-score').textContent = gameScore;
                }
            }
            
            if (gameRunning) {
                gameAnimationId = requestAnimationFrame(gameLoop);
            }
        }

        function openModal(modalId) {
            if (modalId === 'game') {
                initGame();
            }
            document.getElementById(`modal-${modalId}`).classList.add('active');
            document.getElementById('canvas').classList.add('blurred');
        }

        function closeModal(modalId) {
            document.getElementById(`modal-${modalId}`).classList.remove('active');
            document.getElementById('canvas').classList.remove('blurred');
            if (modalId === 'game') {
                gameRunning = false;
                if (gameAnimationId) {
                    cancelAnimationFrame(gameAnimationId);
                }
            }
        }

        function moveAvatar(dx, dy) {
            const newX = avatar.x + dx;
            const newY = avatar.y + dy;
            
            if (newX >= 0 && newX < GRID_WIDTH && newY >= 0 && newY < GRID_HEIGHT) {
                const houseId = map[newY][newX];
                if (houseId && houses[houseId]) {
                    openModal(houses[houseId]);
                    return;
                }
                
                if (map[newY][newX] === 0) {
                    avatar.x = newX;
                    avatar.y = newY;
                    animationFrame++;
                }
            }
            drawWorld();
        }

        setInterval(() => {
            animationFrame++;
            drawWorld();
        }, 100);

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            const tileX = Math.floor(x / TILESIZE);
            const tileY = Math.floor(y / TILESIZE);
            
            socialIcons.forEach(icon => {
                if (tileX === icon.x && tileY === icon.y) {
                    window.open(icon.url, '_blank');
                }
            });
        });

        document.getElementById('game-canvas').addEventListener('click', () => {
            if (gameRunning) {
                gameRobot.jump();
            } else {
                initGame();
            }
        });

        document.addEventListener('keydown', e => {
            const key = e.key.toLowerCase();
            
            if (key === 'escape') {
                closeModal('about');
                closeModal('works');
                closeModal('music');
                closeModal('game');
                return;
            }
            
            if (document.querySelector('.modal-overlay.active')) {
                if (key === ' ' && document.getElementById('modal-game').classList.contains('active')) {
                    e.preventDefault();
                    if (gameRunning) {
                        gameRobot.jump();
                    } else {
                        initGame();
                    }
                }
                return;
            }
            
            if (['arrowup', 'arrowdown', 'arrowleft', 'arrowright', 'w', 'a', 's', 'd'].includes(key)) {
                e.preventDefault();
            }
            
            switch (key) {
                case 'w':
                case 'arrowup':
                    moveAvatar(0, -1);
                    break;
                case 's':
                case 'arrowdown':
                    moveAvatar(0, 1);
                    break;
                case 'a':
                case 'arrowleft':
                    moveAvatar(-1, 0);
                    break;
                case 'd':
                case 'arrowright':
                    moveAvatar(1, 0);
                    break;
                case 'enter':
                    const houseId = map[avatar.y][avatar.x];
                    if (houseId && houses[houseId]) {
                        openModal(houses[houseId]);
                    }
                    break;
            }
        });

        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    const modalId = overlay.id.replace('modal-', '');
                    closeModal(modalId);
                }
            });
        });

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
    </script>
</body>
</html>
